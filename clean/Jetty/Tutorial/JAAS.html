<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Jetty WTP Plugin</title>
    <link href="../../wiki-style.css" media="screen, print" rel="stylesheet" />
  </head>
  <body>
    <div class="heading">
      <p class="heading-title">Archive of wiki.eclipse.org/jetty for End of Life (EOL) Eclipse Jetty 7 and Eclipse Jetty 8.</p>
      <p class="heading-link">
        For up-to-date documentation see
        <a href="https://eclipse.org/jetty">Eclipse Jetty</a>
        project page.
      </p>
      <p class="heading-nav">
        <a href="Jetty.html">Eclipse Jetty 7 Archive Home</a>
      </p>
    </div>
    <div class="col-md-20" id="mainContent">
      <div class="tab-content background-white">
        <div class="tab-pane active" id="tab-pane-main-page-content">
          <h1 class="firstHeading page-header" id="firstHeading">
            <span dir="auto">Jetty/Tutorial/JAAS</span>
          </h1>
          <div id="main-page-content">
            <div class="alert alert-small alert-warning" id="contentSub">
              <span class="subpages">
                &lt;
                <a href="../../Jetty.html" title="Jetty">Jetty</a>
                |
                <a href="../Tutorial.html" title="Jetty/Tutorial">Tutorial</a>
              </span>
            </div>
            <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
              <div class="toc" id="toc">
                <div id="toctitle">
                  <h2>Contents</h2>
                </div>
                <ul>
                  <li class="toclevel-1">
                    <a href="JAAS.html#Introduction">
                      <span class="tocnumber">1</span>
                      <span class="toctext">Introduction</span>
                    </a>
                  </li>
                  <li class="toclevel-1">
                    <a href="JAAS.html#Details">
                      <span class="tocnumber">2</span>
                      <span class="toctext">Details</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Configuring_a_JAASLoginService">
                          <span class="tocnumber">2.1</span>
                          <span class="toctext">Configuring a JAASLoginService</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Declaring_an_org.eclipse.jetty.plus.jaas.JAASLoginService">
                          <span class="tocnumber">2.2</span>
                          <span class="toctext">Declaring an org.eclipse.jetty.plus.jaas.JAASLoginService</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Creating_a_JAAS_login_module_configuration_file">
                          <span class="tocnumber">2.3</span>
                          <span class="toctext">Creating a JAAS login module configuration file</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Specifying_the_JAAS_login_module_configuration_file_on_the_Jetty_run_line">
                          <span class="tocnumber">2.4</span>
                          <span class="toctext">Specifying the JAAS login module configuration file on the Jetty run line</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="JAAS.html#Fine_Tuning_the_JAASLoginService">
                      <span class="tocnumber">3</span>
                      <span class="toctext">Fine Tuning the JAASLoginService</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Understanding_the_RoleCheckPolicy">
                          <span class="tocnumber">3.1</span>
                          <span class="toctext">Understanding the RoleCheckPolicy</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Using_the_CallbackHandler">
                          <span class="tocnumber">3.2</span>
                          <span class="toctext">Using the CallbackHandler</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Configuring_a_Role_Principal_Implementation_Class">
                          <span class="tocnumber">3.3</span>
                          <span class="toctext">Configuring a Role Principal Implementation Class</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="JAAS.html#Examining_Sample_Login_Modules">
                      <span class="tocnumber">4</span>
                      <span class="toctext">Examining Sample Login Modules</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Understanding_Passwords.2FCredentials">
                          <span class="tocnumber">4.1</span>
                          <span class="toctext">Understanding Passwords/Credentials</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#JDBCLoginModule">
                          <span class="tocnumber">4.2</span>
                          <span class="toctext">JDBCLoginModule</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#DataSourceLoginModule">
                          <span class="tocnumber">4.3</span>
                          <span class="toctext">DataSourceLoginModule</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#PropertyFileLoginModule">
                          <span class="tocnumber">4.4</span>
                          <span class="toctext">PropertyFileLoginModule</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#LdapLoginModule">
                          <span class="tocnumber">4.5</span>
                          <span class="toctext">LdapLoginModule</span>
                        </a>
                        <ul>
                          <li class="toclevel-3">
                            <a href="JAAS.html#Configuring_the_Role_Principal_Implementation_Class_for_the_LdapLoginModule.5B1.5D">
                              <span class="tocnumber">4.5.1</span>
                              <span class="toctext">
                                Configuring the Role Principal Implementation Class for the LdapLoginModule
                                <sup>[1]</sup>
                              </span>
                            </a>
                          </li>
                        </ul>
                      </li>
                      <li class="toclevel-2">
                        <a href="JAAS.html#Writing_Your_Own_LoginModule">
                          <span class="tocnumber">4.6</span>
                          <span class="toctext">Writing Your Own LoginModule</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="JAAS.html#Examining_an_Example_JAAS_WebApp">
                      <span class="tocnumber">5</span>
                      <span class="toctext">Examining an Example JAAS WebApp</span>
                    </a>
                  </li>
                  <li class="toclevel-1">
                    <a href="JAAS.html#Other_Goodies">
                      <span class="tocnumber">6</span>
                      <span class="toctext">Other Goodies</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="JAAS.html#RequestParameterCallback">
                          <span class="tocnumber">6.1</span>
                          <span class="toctext">RequestParameterCallback</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="JAAS.html#References">
                      <span class="tocnumber">7</span>
                      <span class="toctext">References</span>
                    </a>
                  </li>
                </ul>
              </div>
              <h2>
                <span class="mw-headline" id="Introduction">Introduction</span>
              </h2>
              <p>
                <br />
                Using JAAS with Jetty is  a matter of completing the following tasks:
              </p>
              <p>
                <a href="JAAS.html#Configuring_a_JAASLoginService">#Configuring a JAASLoginService</a>
              </p>
              <p>
                <a href="JAAS.html#Declaring_an_org.eclipse.jetty.plus.jaas.JAASLoginService">#Declaring an org.eclipse.jetty.plus.jaas.JAASLoginService</a>
              </p>
              <p>
                <a href="JAAS.html#Creating_a_JAAS_login_module_configuration_file">#Creating a JAAS login module configuration file</a>
              </p>
              <p>
                <a href="JAAS.html#Specifying_the_JAAS_login_module_configuration_file_on_the_Jetty_run_line">#Specifying the JAAS login module configuration file on the Jetty run line</a>
              </p>
              <p>
                You should also refer to the JAAS
                <a class="external text" href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials" rel="nofollow">Tutorials</a>
                and
                <a class="external text" href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/JAASRefGuide.html" rel="nofollow">Reference Guide</a>
                .
              </p>
              <h2>
                <span class="mw-headline" id="Details">Details</span>
              </h2>
              <p>The following sections explain how to configure Jetty with JAAS:</p>
              <h3>
                <span class="mw-headline" id="Configuring_a_JAASLoginService">Configuring a JAASLoginService</span>
              </h3>
              <p>
                Configure a Jetty
                <tt>org.eclipse.jetty.plus.jaas.JAASLoginService</tt>
                to match the
                <i>realm-name</i>
                in your
                <tt>web.xml</tt>
                file. For example, if the
                <tt>web.xml</tt>
                contains a realm called "Test JAAS Realm":
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve"><span class="sc3"><span class="re1">&lt;login-config<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;auth-method<span class="re2">&gt;</span></span></span>FORM<span class="sc3"><span class="re1">&lt;/auth-method<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;realm-name<span class="re2">&gt;</span></span></span>Test JAAS Realm<span class="sc3"><span class="re1">&lt;/realm-name<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;form-login-config<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;form-login-page<span class="re2">&gt;</span></span></span>/login/login<span class="sc3"><span class="re1">&lt;/form-login-page<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;form-error-page<span class="re2">&gt;</span></span></span>/login/error<span class="sc3"><span class="re1">&lt;/form-error-page<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/form-login-config<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/login-config<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <h3>
                <span class="mw-headline" id="Declaring_an_org.eclipse.jetty.plus.jaas.JAASLoginService">Declaring an org.eclipse.jetty.plus.jaas.JAASLoginService</span>
              </h3>
              <p>Next declare the following JAASLoginService in a Jetty configuration file:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve">    <span class="sc3"><span class="re1">&lt;Call</span> <span class="re0">name</span>=<span class="st0">"addBean"</span><span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;Arg<span class="re2">&gt;</span></span></span>
          <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.plus.jaas.JAASLoginService"</span><span class="re2">&gt;</span></span>
           <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"Name"</span><span class="re2">&gt;</span></span>Test JAAS Realm<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
           <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"LoginModuleName"</span><span class="re2">&gt;</span></span>xyz<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
          <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;/Arg<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/Call<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <p>Alternatively, of course, you can set this up in a context XML file that configures a web app:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve">  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"securityHandler"</span><span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.security.ConstraintSecurityHandler"</span><span class="re2">&gt;</span></span>
     <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"loginService"</span><span class="re2">&gt;</span></span>
       <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.plus.jaas.JAASLoginService"</span><span class="re2">&gt;</span></span>
         <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"name"</span><span class="re2">&gt;</span></span>Test JAAS Realm<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
         <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"loginModuleName"</span><span class="re2">&gt;</span></span>xyz<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
       <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
     <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <p>
                <br />
              </p>
              <h3>
                <span class="mw-headline" id="Creating_a_JAAS_login_module_configuration_file">Creating a JAAS login module configuration file</span>
              </h3>
              <p>
                Set up your LoginModule in a configuration file, following the
                <a class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/login/Configuration.html" rel="nofollow">syntax rules</a>
                :
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">xyz {
       com.acme.SomeLoginModule required debug=true;
    };</pre>
                </div>
              </div>
              <p>
                <br />
                Read the
                <a class="external text" href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html" rel="nofollow">JAAS tutorial</a>
                for more information on configuration options for LoginModules.
              </p>
              <h3>
                <span class="mw-headline" id="Specifying_the_JAAS_login_module_configuration_file_on_the_Jetty_run_line">Specifying the JAAS login module configuration file on the Jetty run line</span>
              </h3>
              <p>Invoke Jetty with the JAAS configuration file you created above:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"><span class="sy0">&gt;</span> java -Djava.security.auth.login.config=mylogin.conf <span class="re5">-jar</span> start.jar etc<span class="sy0">/</span>myjetty.xml</pre>
                </div>
              </div>
              <h2>
                <span class="mw-headline" id="Fine_Tuning_the_JAASLoginService">Fine Tuning the JAASLoginService</span>
              </h2>
              <p>To allow the greatest degree of flexibility in using JAAS with web applications, the JAASLoginService supports additional configuration options. You don't ordinarily need to set these explicitly, as Jetty has defaults which work in 99% of cases. However, should you need to, you can configure:</p>
              <ul>
                <li>
                  A policy for role-based authorization (Default:
                  <tt>org.eclipse.jetty.plus.jaas.StrictRoleCheckPolicy</tt>
                  ).
                </li>
                <li>
                  A
                  <a class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/callback/CallbackHandler.html" rel="nofollow">CallbackHandler</a>
                  .
                </li>
                <li>
                  A list of classnames for the
                  <a class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/java/security/Principal.html" rel="nofollow">Principal</a>
                  implementation that equate to a user role (Default:
                  <tt>org.eclipse.jetty.plus.jaas.JAASRole</tt>
                  ).
                </li>
              </ul>
              <p>Here's an example that sets each of these:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve"><span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.plus.jaas.JAASLoginService"</span><span class="re2">&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"Name"</span><span class="re2">&gt;</span></span>xyzrealm<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"LoginModuleName"</span><span class="re2">&gt;</span></span>xyz<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"RoleCheckPolicy"</span><span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.plus.jaas.StrictRoleCheckPolicy"</span><span class="re2">/&gt;</span></span>  <span class="sc-1">&lt;!-- default --&gt;</span>
  <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"CallbackHandlerClass"</span><span class="re2">&gt;</span></span>
    com.acme.MyCallbackHandler
  <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"roleClassNames"</span><span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;Array</span> <span class="re0">type</span>=<span class="st0">"java.lang.String"</span><span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;Item<span class="re2">&gt;</span></span></span>org.eclipse.jetty.plus.jaas.JAASRole<span class="sc3"><span class="re1">&lt;/Item<span class="re2">&gt;</span></span></span> <span class="sc-1">&lt;!-- default --&gt;</span>
    <span class="sc3"><span class="re1">&lt;/Array<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <h3>
                <span class="mw-headline" id="Understanding_the_RoleCheckPolicy">Understanding the RoleCheckPolicy</span>
              </h3>
              <p>
                The RoleCheckPolicy must be an implementation of the
                <tt>org.eclipse.jetty.plus.jaas.RoleCheckPolicy</tt>
                interface, and its purpose is to help answer the question "is User X in Role Y?" for role-based authorization requests. The default implementation distributed with Jetty is the
                <tt>org.eclipse.jetty.plus.jaas.StrictRoleCheckPolicy</tt>
                , which assesses a user as having a particular role if that role is at the top of the stack of roles that have been temporarily pushed onto the user, or if the user has no temporarily assigned roles, the role is among those configured for the user.
              </p>
              <p>
                You can temporarily assign roles to a user programmatically by using the
                <tt>pushRole(String rolename)</tt>
                method of the
                <tt>org.eclipse.jetty.plus.jaas.JAASUserPrincipal</tt>
                class.
              </p>
              <p>For the majority of webapps, the default StrictRoleCheckPolicy is adequate, but you can provide your own implementation and set it on your tt&gt;JAASLoginService&lt;/tt&gt; instance.</p>
              <h3>
                <span class="mw-headline" id="Using_the_CallbackHandler">Using the CallbackHandler</span>
              </h3>
              <p>
                A
                <a class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/callback/CallbackHandler.html" rel="nofollow">CallbackHandler</a>
                is responsible for interfacing with the user to obtain usernames and credentials to be authenticated.
              </p>
              <p>
                Jetty ships with a CallbackHandler which interfaces the information contained in the
                <a class="external text" href="http://download.oracle.com/javaee/5/api/javax/servlet/http/HttpServletRequest.html" rel="nofollow">request</a>
                to the
                <a class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/callback/Callback.html" rel="nofollow">Callbacks</a>
                that
                <a class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/spi/LoginModule.html" rel="nofollow">LoginModules</a>
                requests. You can replace this default with your own implementation if you have specific requirements not covered by the default.
              </p>
              <h3>
                <span class="mw-headline" id="Configuring_a_Role_Principal_Implementation_Class">Configuring a Role Principal Implementation Class</span>
              </h3>
              <p>
                When LoginModules authenticate a user, they usually also gather all of the roles that a user has and place them inside the JAAS
                <a class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/Subject.html" rel="nofollow">Subject</a>
                . As LoginModules are free to use their own implementation of the JAAS
                <a class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/java/security/Principal.html" rel="nofollow">Principal</a>
                to put into the Subject, Jetty needs to know which Principals represent the user and which represent his/her roles when performing authorization checks on
                <i>security-constraints</i>
                . The example LoginModules that ship with jetty all use the
                <tt>org.mortbay.jetty.plus.jaas.JAASRole</tt>
                class. However, if you have plugged in some other LoginModules, you must configure the classnames of their role Principal implementations.
              </p>
              <h2>
                <span class="mw-headline" id="Examining_Sample_Login_Modules">Examining Sample Login Modules</span>
              </h2>
              <p>At the time of writing, Jetty provides four sample LoginModule implementations:</p>
              <ul>
                <li>org.eclipse.jetty.plus.jaas.spi.JDBCLoginModule</li>
                <li>org.eclipse.jetty.plus.jaas.spi.PropertyFileLoginModule</li>
                <li>org.eclipse.jetty.plus.jaas.spi.DataSourceLoginModule</li>
                <li>org.eclipse.jetty.plus.jaas.ldap.LdapLoginModule</li>
              </ul>
              <p>We'll take a look at all of these, but first, a word about password handling in Jetty, as it applies to all LoginModules.</p>
              <h3>
                <span class="mw-headline" id="Understanding_Passwords.2FCredentials">Understanding Passwords/Credentials</span>
              </h3>
              <p>
                Passwords can be stored in clear text, obfuscated or checksummed.  Use the class
                <tt>org.eclipse.jetty.http.security.Password</tt>
                to generate all varieties of passwords, the output from which you can cut and paste into property files or enter into database tables.
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"><span class="sy0">&gt;</span> java <span class="re5">-cp</span> lib<span class="sy0">/</span>jetty.jar org.eclipse.jetty.http.security.Password
Usage - java org.eclipse.jetty.http.security.Password <span class="br0">[</span><span class="sy0">&lt;</span>user<span class="sy0">&gt;</span><span class="br0">]</span> <span class="sy0">&lt;</span>password<span class="sy0">&gt;</span>
<span class="sy0">&gt;</span> java <span class="re5">-cp</span> lib<span class="sy0">/</span>jetty.jar org.eclipse.jetty.http.security.Password me you
you
OBF:20771x1b206z
MD5:639bae9ac6b3e1a84cebb7b403297b79
CRYPT:me<span class="sy0">/</span>ks90E221EY</pre>
                </div>
              </div>
              <p>
                Read more on
                <a href="../Howto/Secure%20Passwords.html" title="Jetty/Howto/Secure Passwords">securing passwords</a>
                .
              </p>
              <h3>
                <span class="mw-headline" id="JDBCLoginModule">JDBCLoginModule</span>
              </h3>
              <p>The JDBCLoginModule stores user passwords and roles in a database that is accessed via JDBC calls. You can configure the JDBC connection information, as well as the names of the table and columns storing the username and credential, and the name of the table and columns storing the roles.</p>
              <p>Here is an example login module configuration file entry for it using an HSQLDB driver:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">jdbc {
         org.eclipse.jetty.plus.jaas.spi.JDBCLoginModule required
         debug="true"
         dbUrl="jdbc:hsqldb:."
         dbUserName="sa"
         dbPassword="secret"
         dbDriver="org.hsqldb.jdbcDriver"
         userTable="myusers"
         userField="myuser"
         credentialField="mypassword"
         userRoleTable="myuserroles"
         userRoleUserField="myuser"
         userRoleRoleField="myrole";
     };</pre>
                </div>
              </div>
              <p>
                There is no particular schema required for the database tables storing the authentication and role information. The properties
                <i>userTable</i>
                ,
                <i>userField</i>
                , c
                <i>redentialField</i>
                ,
                <i>userRoleTable</i>
                ,
                <i>userRoleUserField</i>
                ,
                <i>userRoleRoleField</i>
                configure the names of the tables and the columns within them that are used to format the following queries:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="sql source-sql">
                  <pre class="de1" xml:space="preserve"><span class="kw1">SELECT</span> <span class="sy0">&lt;</span>credentialField<span class="sy0">&gt;</span> <span class="kw1">FROM</span> <span class="sy0">&lt;</span>userTable<span class="sy0">&gt;</span> <span class="kw1">WHERE</span> <span class="sy0">&lt;</span>userField<span class="sy0">&gt;</span> <span class="sy0">=</span>?
<span class="kw1">SELECT</span> <span class="sy0">&lt;</span>userRoleRoleField<span class="sy0">&gt;</span> <span class="kw1">FROM</span> <span class="sy0">&lt;</span>userRoleTable<span class="sy0">&gt;</span> <span class="kw1">WHERE</span> <span class="sy0">&lt;</span>userRoleUserField<span class="sy0">&gt;</span> <span class="sy0">=</span>?</pre>
                </div>
              </div>
              <p>Credential and role information is lazily read from the database when a previously unauthenticated user requests authentication. This information is only cached for the length of the authenticated session. When the user logs out or the session expires, the information is flushed from memory.</p>
              <p>
                <br />
              </p>
              <h3>
                <span class="mw-headline" id="DataSourceLoginModule">DataSourceLoginModule</span>
              </h3>
              <p>
                Similar to the JDBCLoginModule, but this LoginModule uses a DataSource to connect to the database instead of a JDBC driver. The DataSource is obtained by doing a JNDI lookup on
                <tt>java:comp/env/$\{dnJNDIName\}</tt>
                .
              </p>
              <p>Here is a sample login module configuration for the DataSourceLoginModule:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">ds {
       org.eclipse.jetty.plus.jaas.spi.DataSourceLoginModule required
       debug="true"
       dbJNDIName="ds"
       userTable="myusers"
       userField="myuser"
       credentialField="mypassword"
       userRoleTable="myuserroles"
       userRoleUserField="myuser"
       userRoleRoleField="myrole";
   };</pre>
                </div>
              </div>
              <h3>
                <span class="mw-headline" id="PropertyFileLoginModule">PropertyFileLoginModule</span>
              </h3>
              <p>With this login module implementation, the authentication and role information is read from a property file.</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">props {
          org.eclipse.jetty.plus.jaas.spi.PropertyFileLoginModule required
          debug="true"
          file="/somewhere/somefile.props";
      };</pre>
                </div>
              </div>
              <p>
                The file parameter is the location of a properties file of the same format as the
                <tt>etc/realm.properties</tt>
                example file. The format is:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">&lt;username&gt;: &lt;password&gt;[,&lt;rolename&gt; ...]</pre>
                </div>
              </div>
              <p>Here's an example:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">fred: OBF:1xmk1w261u9r1w1c1xmq,user,admin
harry: changeme,user,developer
tom: MD5:164c88b302622e17050af52c89945d44,user
dick: CRYPT:adpexzg3FUZAk,admin</pre>
                </div>
              </div>
              <p>The contents of the file are fully read in and cached in memory the first time a user requests authentication.</p>
              <h3>
                <span class="mw-headline" id="LdapLoginModule">LdapLoginModule</span>
              </h3>
              <p>
                The LdapLoginModule ships in a separate jar, in
                <tt>$JETTY-HOME/lib/ext/jetty-ldap-jaas.jar</tt>
                . It requires JDK1.5 or above.
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">ldaploginmodule {
   org.eclipse.jetty.plus.jaas.spi.LdapLoginModule required
   debug="true"
   contextFactory="com.sun.jndi.ldap.LdapCtxFactory"
   hostname="ldap.example.com"
   port="389"
   bindDn="cn=Directory Manager"
   bindPassword="directory"
   authenticationMethod="simple"
   forceBindingLogin="false"
   userBaseDn="ou=people,dc=alcatel"
   userRdnAttribute="uid"
   userIdAttribute="uid"
   userPasswordAttribute="userPassword"
   userObjectClass="inetOrgPerson"
   roleBaseDn="ou=groups,dc=example,dc=com"
   roleNameAttribute="cn"
   roleMemberAttribute="uniqueMember"
   roleObjectClass="groupOfUniqueNames";
   };</pre>
                </div>
              </div>
              <h4>
                <span class="mw-headline" id="Configuring_the_Role_Principal_Implementation_Class_for_the_LdapLoginModule.5B1.5D">
                  Configuring the Role Principal Implementation Class for the LdapLoginModule
                  <sup class="reference" id="cite_ref-1">
                    <a href="JAAS.html#cite_note-1">[1]</a>
                  </sup>
                </span>
              </h4>
              <p>
                The LdapLoginModule does not deal with the situation of user -&gt; some group -&gt; role group, as it assigns users directly to the role group. If you want to specify role occupants by groups within an organization, you need the ability to sort them in this way. The following example shows how to do so by configuring
                <i>RoleClassNames</i>
                information. This example implements
                <a class="external text" href="http://waffle.codeplex.com/" rel="nofollow">WAFFLE</a>
                , which lets you run Jetty under Windows with Active Directory.
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve"><span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.mortbay.jetty.plus.jaas.JAASUserRealm"</span><span class="re2">&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"name"</span><span class="re2">&gt;</span></span>MyTestRealm<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"LoginModuleName"</span><span class="re2">&gt;</span></span>Jaas<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"RoleClassNames"</span><span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;Array</span> <span class="re0">type</span>=<span class="st0">"java.lang.String"</span><span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;Item<span class="re2">&gt;</span></span></span>waffle.jaas.UserPrincipal<span class="sc3"><span class="re1">&lt;/Item<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;Item<span class="re2">&gt;</span></span></span>waffle.jaas.RolePrincipal<span class="sc3"><span class="re1">&lt;/Item<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/Array<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <p>Along with:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">Jaas {
waffle.jaas.WindowsLoginModule sufficient debug=true;
};</pre>
                </div>
              </div>
              <p>Add the necessary WAFFLE classes to the Jetty lib directory. Then start Jetty:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"><span class="sy0">&gt;</span> java -Djava.security.auth.login.config=<span class="re1">$jetty</span>.home<span class="sy0">/</span>etc<span class="sy0">/</span>waffle-login.conf <span class="re5">-jar</span> start.jar etc<span class="sy0">/</span>myjetty.xml</pre>
                </div>
              </div>
              <h3>
                <span class="mw-headline" id="Writing_Your_Own_LoginModule">Writing Your Own LoginModule</span>
              </h3>
              <p>If you want to implement your own custom LoginModule, there are two classes you should be familiar with:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="java source-java">
                  <pre class="de1" xml:space="preserve">AbstractLoginModule.<span class="me1">java</span>
 
<span class="kw1">package</span> <span class="co2">org.eclipse.jetty.plus.jaas.spi</span><span class="sy0">;</span>
 
<span class="kw1">public</span> <span class="kw1">abstract</span> <span class="kw1">class</span> AbstractLoginModule <span class="kw1">implements</span> LoginModule
<span class="br0">{</span>
  ...
  <span class="kw1">public</span> <span class="kw1">abstract</span> UserInfo getUserInfo <span class="br0">(</span><span class="kw3">String</span> username<span class="br0">)</span> <span class="kw1">throws</span> <span class="kw3">Exception</span><span class="sy0">;</span>
<span class="br0">}</span></pre>
                </div>
              </div>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="java source-java">
                  <pre class="de1" xml:space="preserve">UserInfo.<span class="me1">java</span>
 
<span class="kw1">package</span> <span class="co2">org.eclipse.jetty.plus.jaas.spi</span><span class="sy0">;</span>
 
<span class="kw1">public</span> <span class="kw1">class</span> UserInfo
<span class="br0">{</span>
 
  <span class="kw1">public</span> UserInfo <span class="br0">(</span><span class="kw3">String</span> userName, Credential credential, <span class="kw3">List</span> roleNames<span class="br0">)</span>
  <span class="br0">{</span>
    ...
  <span class="br0">}</span>
 
  <span class="kw1">public</span> <span class="kw3">String</span> getUserName<span class="br0">(</span><span class="br0">)</span>
  <span class="br0">{</span>
    ...
  <span class="br0">}</span>
 
  <span class="kw1">public</span> <span class="kw3">List</span> getRoleNames <span class="br0">(</span><span class="br0">)</span>
  <span class="br0">{</span>
    ...
  <span class="br0">}</span>
 
  <span class="kw1">public</span> <span class="kw4">boolean</span> checkCredential <span class="br0">(</span><span class="kw3">Object</span> suppliedCredential<span class="br0">)</span>
  <span class="br0">{</span>
     ...
  <span class="br0">}</span>
<span class="br0">}</span></pre>
                </div>
              </div>
              <p>
                The
                <tt>org.eclipse.jetty.plus.jaas.spi.AbstractLoginModule</tt>
                implements all of the
                <tt>javax.security.auth.spi.LoginModule</tt>
                methods. All you need to do is to implement the
                <tt>getUserInfo</tt>
                method to return an
                <tt>org.eclipse.jetty.plus.jaas.UserInfo</tt>
                instance which encapsulates the username, password and role names as
                <tt>java.lang.Strings</tt>
                for a user.
              </p>
              <p>
                The AbstractLoginModule does not support any caching, so if you want to cache UserInfo (as, for example, does the
                <tt>org.mortbay.jetty.plus.jaas.spi.PropertyFileLoginModule</tt>
                , then you must provide this yourself.
              </p>
              <h2>
                <span class="mw-headline" id="Examining_an_Example_JAAS_WebApp">Examining an Example JAAS WebApp</span>
              </h2>
              <p>
                There is an example of authentication and web authorization in the Jetty distribution in
                <tt>examples/test-jaas-webapp</tt>
                . It uses the PropertyFileLoginModule to perform authentication based on a simple properties file.  To use it with the
                <a class="external text" href="http://jetty.mortbay.org/maven-plugin/index.html" rel="nofollow">jetty maven plugin</a>
                :
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">&gt; cd examples/test-jaas-webapp
&gt; mvn jetty:run</pre>
                </div>
              </div>
              <p>Alternatively, to use it instead with Jetty standalone:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="text source-text">
                  <pre class="de1" xml:space="preserve">&gt; cd examples/test-jaas-webapp
&gt; mvn clean install
&gt; cd ../../
&gt; java -jar start.jar etc/jetty.xml etc/jetty-jaas.xml</pre>
                </div>
              </div>
              <p>Then surf to http://localhost:8080/test-jaas/index.html.</p>
              <h2>
                <span class="mw-headline" id="Other_Goodies">Other Goodies</span>
              </h2>
              <h3>
                <span class="mw-headline" id="RequestParameterCallback">RequestParameterCallback</span>
              </h3>
              <p>
                As all servlet containers intercept and process a form submission with action
                <tt>j_security_check</tt>
                , it is usually not possible to insert any extra input fields onto a login form with which to perform authentication: you may only pass
                <tt>j_username</tt>
                and
                <tt>j_password</tt>
                . For those rare occasions when this is not good enough, and you require more information from the user in order to authenticate them, you can use the JAAS callback handler
                <tt>org.mortbay.jetty.plus.jaas.callback.RequestParameterCallback</tt>
                . This callback handler gives you access to all parameters passed in the form submission. To use it, in the
                <tt>login()</tt>
                method of your custom login module, add the RequestParameterCallback to the list of callback handlers the login module uses, tell it which parameters you are want, and then get the value of the parameter back. Here's an example:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="java source-java">
                  <pre class="de1" xml:space="preserve">FooLoginModule.<span class="me1">java</span>
 
<span class="kw1">public</span> <span class="kw1">class</span> FooLoginModule <span class="kw1">extends</span> AbstractLoginModule
<span class="br0">{</span>
        .
        .
        .
 
     <span class="kw1">public</span> <span class="kw4">boolean</span> login<span class="br0">(</span><span class="br0">)</span>
        <span class="kw1">throws</span> LoginException
     <span class="br0">{</span>
        .
        .
        .
        <span class="me1">Callback</span><span class="br0">[</span><span class="br0">]</span> callbacks <span class="sy0">=</span> <span class="kw1">new</span> Callback<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span><span class="sy0">;</span>
        callbacks<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw1">new</span> NameCallback<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        callbacks<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw1">new</span> ObjectCallback<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
        <span class="co1">//as an example, look for a param named "extrainfo" in the request</span>
        <span class="co1">//use one RequestParameterCallback() instance for each param you want to access</span>
        callbacks<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw1">new</span> RequestParameterCallback <span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">(</span><span class="br0">(</span>RequestParameterCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">setParameterName</span> <span class="br0">(</span><span class="st0">"extrainfo"</span><span class="br0">)</span><span class="sy0">;</span>
        .
        .
        .
        .<span class="kw1">public</span><span class="kw4">boolean</span>login<span class="br0">(</span><span class="br0">)</span><span class="kw1">throws</span>LoginException<span class="br0">{</span>.
        .
        .<span class="me1">Callback</span><span class="br0">[</span><span class="br0">]</span>callbacks<span class="sy0">=</span><span class="kw1">new</span>Callback<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span><span class="sy0">;</span>callbacks<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">=</span><span class="kw1">new</span>NameCallback<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>callbacks<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">=</span><span class="kw1">new</span>ObjectCallback<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="co1">//as an example, look for a param named "extrainfo" in the request</span><span class="co1">//use one RequestParameterCallback() instance for each param you want to access</span>callbacks<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="sy0">=</span><span class="kw1">new</span>RequestParameterCallback<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">(</span><span class="br0">(</span>RequestParameterCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">setParameterName</span><span class="br0">(</span><span class="st0">"extrainfo"</span><span class="br0">)</span><span class="sy0">;</span>.
        .
        .<span class="me1">callbackHandler</span>.<span class="me1">handle</span><span class="br0">(</span>callbacks<span class="br0">)</span><span class="sy0">;</span><span class="kw3">String</span>userName<span class="sy0">=</span><span class="br0">(</span><span class="br0">(</span>NameCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">getName</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw3">Object</span>pwd<span class="sy0">=</span><span class="br0">(</span><span class="br0">(</span>ObjectCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">getObject</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw3">List</span>paramValues<span class="sy0">=</span><span class="br0">(</span><span class="br0">(</span>RequestParameterCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">getParameterValues</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="co1">//use the userName, pwd and the value(s) of the parameter named "extrainfo" to</span><span class="co1">//authenticate the user</span>.
        .
     <span class="br0">}</span></pre>
                </div>
              </div>
              <h2>
                <span class="mw-headline" id="References">References</span>
              </h2>
              <ol class="references">
                <li id="cite_note-1">
                  <span class="mw-cite-backlink">
                    <a href="JAAS.html#cite_ref-1">↑</a>
                  </span>
                  <span class="reference-text">
                    Jay Jaeger, IT Management Consultant at the State of Wisconsin, provided this example. In turn, Jaeger writes, "I would never have figured this out had it not been for the article at
                    <a class="external free" href="http://mail-archives.apache.org/mod_mbox/karaf-issues/201012.mbox/%3C30176778.74721292097241071.JavaMail.jira@thor%3E" rel="nofollow">http://mail-archives.apache.org/mod_mbox/karaf-issues/201012.mbox/%3C30176778.74721292097241071.JavaMail.jira@thor%3E</a>
                    ."
                  </span>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
