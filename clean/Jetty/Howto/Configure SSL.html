<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Jetty WTP Plugin</title>
    <link href="../../wiki-style.css" media="screen, print" rel="stylesheet" />
  </head>
  <body>
    <div class="heading">
      <p class="heading-title">Archive of wiki.eclipse.org/jetty for End of Life (EOL) Eclipse Jetty 7 and Eclipse Jetty 8.</p>
      <p class="heading-link">
        For up-to-date documentation see
        <a href="https://eclipse.org/jetty">Eclipse Jetty</a>
        project page.
      </p>
      <p class="heading-nav">
        <a href="Jetty.html">Eclipse Jetty 7 Archive Home</a>
      </p>
    </div>
    <div class="col-md-20" id="mainContent">
      <div class="tab-content background-white">
        <div class="tab-pane active" id="tab-pane-main-page-content">
          <h1 class="firstHeading page-header" id="firstHeading">
            <span dir="auto">Jetty/Howto/Configure SSL</span>
          </h1>
          <div id="main-page-content">
            <div class="alert alert-small alert-warning" id="contentSub">
              <span class="subpages">
                &lt;
                <a href="../../Jetty.html" title="Jetty">Jetty</a>
                |
                <a href="../Howto.html" title="Jetty/Howto">Howto</a>
              </span>
            </div>
            <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
              <h2>
                <span class="mw-headline" id="Introduction">Introduction</span>
              </h2>
              <p>
                <br />
                This is an overview of how to configure SSL for Jetty, which uses Sun's reference implementation for the Java Secure Sockets Extension (JSSE).
              </p>
              <div class="toc" id="toc">
                <div id="toctitle">
                  <h2>Contents</h2>
                </div>
                <ul>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Introduction">
                      <span class="tocnumber">1</span>
                      <span class="toctext">Introduction</span>
                    </a>
                  </li>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Understanding_Certificates_and_Keys">
                      <span class="tocnumber">2</span>
                      <span class="toctext">Understanding Certificates and Keys</span>
                    </a>
                  </li>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Configuring_Jetty_for_SSL">
                      <span class="tocnumber">3</span>
                      <span class="toctext">Configuring Jetty for SSL</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#OpenSSL_Versus_Keytool">
                          <span class="tocnumber">3.1</span>
                          <span class="toctext">OpenSSL Versus Keytool</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Generating_Key_Pairs_and_Certificates">
                      <span class="tocnumber">4</span>
                      <span class="toctext">Generating Key Pairs and Certificates</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Generating_Keys_and_Certificates_with_JDK_keytool">
                          <span class="tocnumber">4.1</span>
                          <span class="toctext">Generating Keys and Certificates with JDK keytool</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Generating_Keys_and_Certificates_with_OpenSSL">
                          <span class="tocnumber">4.2</span>
                          <span class="toctext">Generating Keys and Certificates with OpenSSL</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Using_Keys_and_Certificates_from_Other_Sources">
                          <span class="tocnumber">4.3</span>
                          <span class="toctext">Using Keys and Certificates from Other Sources</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Requesting_a_Trusted_Certificate">
                      <span class="tocnumber">5</span>
                      <span class="toctext">Requesting a Trusted Certificate</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Generating_a_CSR_from_keytool">
                          <span class="tocnumber">5.1</span>
                          <span class="toctext">Generating a CSR from keytool</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Generating_a_CSR_from_OpenSSL">
                          <span class="tocnumber">5.2</span>
                          <span class="toctext">Generating a CSR from OpenSSL</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Loading_Keys_and_Certificates">
                      <span class="tocnumber">6</span>
                      <span class="toctext">Loading Keys and Certificates</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Loading_Certificates_with_keytool">
                          <span class="tocnumber">6.1</span>
                          <span class="toctext">Loading Certificates with keytool</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Loading_Keys_and_Certificates_via_PKCS12">
                          <span class="tocnumber">6.2</span>
                          <span class="toctext">Loading Keys and Certificates via PKCS12</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Configuring_Jetty">
                      <span class="tocnumber">7</span>
                      <span class="toctext">Configuring Jetty</span>
                    </a>
                    <ul>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Choosing_a_Directory_for_the_keystore">
                          <span class="tocnumber">7.1</span>
                          <span class="toctext">Choosing a Directory for the keystore</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Setting_the_Port_for_https">
                          <span class="tocnumber">7.2</span>
                          <span class="toctext">Setting the Port for https</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Redirecting_http_requests_to_https">
                          <span class="tocnumber">7.3</span>
                          <span class="toctext">Redirecting http requests to https</span>
                        </a>
                      </li>
                      <li class="toclevel-2">
                        <a href="Configure%20SSL.html#Configuring_SSL_for_Earlier_Versions_of_Jetty">
                          <span class="tocnumber">7.4</span>
                          <span class="toctext">Configuring SSL for Earlier Versions of Jetty</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Password_Issues">
                      <span class="tocnumber">8</span>
                      <span class="toctext">Password Issues</span>
                    </a>
                  </li>
                  <li class="toclevel-1">
                    <a href="Configure%20SSL.html#Renewing_Certificates">
                      <span class="tocnumber">9</span>
                      <span class="toctext">Renewing Certificates</span>
                    </a>
                  </li>
                </ul>
              </div>
              <h2>
                <span class="mw-headline" id="Understanding_Certificates_and_Keys">Understanding Certificates and Keys</span>
              </h2>
              <p>Configuring SSL can be a confusing experience of keys, certificates, protocols and formats, thus it helps to have a reasonable understanding of the basics. The following links provide some good starting points:</p>
              <ul>
                <li>
                  Certificates:
                  <ul>
                    <li>
                      <a class="external text" href="http://en.tldp.org/HOWTO/SSL-Certificates-HOWTO" rel="nofollow">SSL Certificates HOWTO</a>
                    </li>
                    <li>
                      <a class="external text" href="http://mindprod.com/jgloss/certificate.html" rel="nofollow">Mindprod Java Glossary definition</a>
                    </li>
                  </ul>
                </li>
                <li>
                  Keytool:
                  <ul>
                    <li>
                      <a class="external text" href="http://java.sun.com/j2se/1.4.1/docs/tooldocs/solaris/keytool.html" rel="nofollow">Keytool for Unix</a>
                    </li>
                    <li>
                      <a class="external text" href="http://java.sun.com/j2se/1.4.1/docs/tooldocs/windows/keytool.html" rel="nofollow">Keytool for Windows</a>
                    </li>
                  </ul>
                </li>
                <li>
                  Other tools:
                  <ul>
                    <li>
                      <a class="external text" href="http://www.alphaworks.ibm.com/tech/keyman" rel="nofollow">IBM Keyman</a>
                    </li>
                  </ul>
                </li>
                <li>
                  OpenSSL:
                  <ul>
                    <li>
                      <a class="external text" href="http://www.openssl.org/docs/HOWTO/" rel="nofollow">OpenSSL HOWTO</a>
                    </li>
                    <li>
                      <a class="external text" href="http://www.openssl.org/support/faq.html" rel="nofollow">FAQ</a>
                    </li>
                  </ul>
                </li>
              </ul>
              <h2>
                <span class="mw-headline" id="Configuring_Jetty_for_SSL">Configuring Jetty for SSL</span>
              </h2>
              <p>To configure Jetty for SSL, complete the tasks in the following sections:</p>
              <p>
                <a href="Configure%20SSL.html#Generating_Key_Pairs_and_Certificates">Generating Key Pairs and Certificates</a>
              </p>
              <p>
                <a href="Configure%20SSL.html#Requesting_a_Trusted_Certificate">Requesting a Trusted Certificate</a>
              </p>
              <p>
                <a href="Configure%20SSL.html#Loading_Keys_and_Certificates">Loading Keys and Certificates</a>
              </p>
              <p>
                <a href="Configure%20SSL.html#Configuring_Jetty">Configuring Jetty</a>
              </p>
              <h3>
                <span class="mw-headline" id="OpenSSL_Versus_Keytool">OpenSSL Versus Keytool</span>
              </h3>
              <p>
                For testing, keytool probably provides the simplest way to generate the key and certificate you need. However, IBM's
                <a class="external text" href="http://www.alphaworks.ibm.com/tech/keyman" rel="nofollow">keyman</a>
                is also pretty good, and provides a GUI rather than a command line.
              </p>
              <p>You can also use the OpenSSL tools to generate keys and certificates, or to convert those that you have used with Apache or other servers. Since Apache and other servers commonly use the OpenSSL tool suite to generate and manipulate keys and certificates, you might already have some keys and certificates created by OpenSSL. Also, OpenSSL might be more trusted than keytool or some certificate authorities. You might also prefer the formats OpenSSL produces.</p>
              <p>If you want the option of using the same certificate with Jetty or a web server such as Apache not written in Java, you might prefer to generate your private key and certificate with OpenSSL. The Java keytool does not provide options for exporting private keys, and Apache needs the private key. If you create the key and certificate with OpenSSL, your non-Java web server has ready access to it.</p>
              <h2>
                <span class="mw-headline" id="Generating_Key_Pairs_and_Certificates">Generating Key Pairs and Certificates</span>
              </h2>
              <p>
                The simplest way to generate keys and certificates is to use the keytool application that comes with the JDK, as it generates keys and certificates directly into the keystore. See
                <a href="Configure%20SSL.html#Generating_a_Certificate_with_JDK_keytool">Generating a Certificate with JDK keytool</a>
                .
              </p>
              <p>
                If you already have keys and certificates, see
                <a href="Configure%20SSL.html#Loading_Keys_and_Certificates">Loading Keys and Certificates</a>
                to load them into a JSSE key store. This section also applies if you have a renewal certificate to replace one that is expiring.
              </p>
              <p>The examples below generate only basic keys and certificates. You should read the full manuals of the tools you are using if you want to specify:</p>
              <ul>
                <li>Key size.</li>
                <li>Certificate expiry.</li>
                <li>Alternate security providers.</li>
              </ul>
              <h3>
                <span class="mw-headline" id="Generating_Keys_and_Certificates_with_JDK_keytool">Generating Keys and Certificates with JDK keytool</span>
              </h3>
              <p>The following command generates a key pair and certificate directly into a keystore:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> keytool <span class="re5">-keystore</span> keystore <span class="re5">-alias</span> jetty <span class="re5">-genkey</span> <span class="re5">-keyalg</span> RSA</pre>
                </div>
              </div>
              <p>
                <br />
                This command prompts for information about the certificate and for passwords to protect both the keystore and the keys within it. The only mandatory response is to provide the fully qualified host name of the server at the "first and last name" prompt. For example:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> keytool <span class="re5">-keystore</span> keystore <span class="re5">-alias</span> jetty <span class="re5">-genkey</span> <span class="re5">-keyalg</span> RSA
 Enter keystore password:  password
 What is your first and
                    <span class="kw2">last</span>
                    name?
                    <span class="br0">[</span>
                    Unknown
                    <span class="br0">]</span>
                    :  jetty.eclipse.org
 What is the name of your organizational unit?
                    <span class="br0">[</span>
                    Unknown
                    <span class="br0">]</span>
                    :  Jetty
 What is the name of your organization?
                    <span class="br0">[</span>
                    Unknown
                    <span class="br0">]</span>
                    :  Mort Bay Consulting Pty. Ltd.
 What is the name of your City or Locality?
                    <span class="br0">[</span>
                    Unknown
                    <span class="br0">]</span>
                    :
 What is the name of your State or Province?
   <span class="br0">[</span>Unknown<span class="br0">]</span>:
 What is the two-letter country code <span class="kw1">for</span> this unit?
   <span class="br0">[</span>Unknown<span class="br0">]</span>:
 Is <span class="re2">CN</span>=jetty.eclipse.org, <span class="re2">OU</span>=Jetty, <span class="re2">O</span>=Mort Bay Consulting Pty. Ltd.,
 <span class="re2">L</span>=Unknown, <span class="re2">ST</span>=Unknown, <span class="re2">C</span>=Unknown correct?
   <span class="br0">[</span>no<span class="br0">]</span>:  <span class="kw2">yes</span>
 
 Enter key password <span class="kw1">for</span> <span class="sy0">&lt;</span>jetty<span class="sy0">&gt;</span>
         <span class="br0">(</span>RETURN <span class="kw1">if</span> same <span class="kw2">as</span> keystore password<span class="br0">)</span>:  password</pre>
                </div>
              </div>
              <p>
                You now have the minimal requirements to run an SSL connection and could proceed directly to
                <a href="Configure%20SSL.html#Configuring_Jetty">Configuring Jetty</a>
                to configure an SSL connector. However the browser will not trust the certificate you have generated, and will prompt the user to this effect. While what you have at this point is often sufficient for testing, most public sites need to request a trusted certificate, as shown in the section,
                <a href="Configure%20SSL.html#Obtaining_a_CSR_from_keytool">Obtaining a CSR from keytool</a>
                .
              </p>
              <h3>
                <span class="mw-headline" id="Generating_Keys_and_Certificates_with_OpenSSL">Generating Keys and Certificates with OpenSSL</span>
              </h3>
              <p>
                The following command generates a key pair in the file
                <tt>jetty.key</tt>
                :
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> openssl genrsa <span class="re5">-des3</span> <span class="re5">-out</span> jetty.key</pre>
                </div>
              </div>
              <p>
                You might also want to use the
                <tt>-rand</tt>
                file argument to provide an arbitrary file that helps seed the random number generator.
              </p>
              <p>
                The following command generates a certificate for the key into the file
                <tt>jetty.crt</tt>
                :
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> openssl req <span class="re5">-new</span> <span class="re5">-x509</span> <span class="re5">-key</span> jetty.key <span class="re5">-out</span> jetty.crt</pre>
                </div>
              </div>
              <p>
                <br />
                The next command prompts for information about the certificate and for passwords to protect both the keystore and the keys within it. The only mandatory response is to provide the fully qualified host name of the server at the
                <i>Common Name</i>
                prompt. For example:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> openssl genrsa <span class="re5">-des3</span> <span class="re5">-out</span> jetty.key
 Generating RSA private key, <span class="nu0">512</span> bit long modulus
 ...........................++++++++++++
 ..++++++++++++
 e is
                    <span class="nu0">65537</span>
                    <span class="br0">(</span>
                    0x10001
                    <span class="br0">)</span>
                    Enter pass phrase
                    <span class="kw1">for</span>
                    jetty.key:
 Verifying - Enter pass phrase
                    <span class="kw1">for</span>
                    jetty.key:
                    <span class="co0"># openssl req -new -x509 -key jetty.key -out jetty.crt</span>
                    Enter pass phrase
                    <span class="kw1">for</span>
                    jetty.key:
 You are about to be asked to enter information to be incorporated
 into your certificate request.
 What you are about to enter is what is called a Distinguished Name or a DN.
 There are quite a few fields but you can leave some blank
 For some fields there is a default value,
 If you enter <span class="st_h">'.'</span>, the field is left blank.
 <span class="re5">-----</span>
 Country Name <span class="br0">(</span><span class="nu0">2</span> letter code<span class="br0">)</span> <span class="br0">[</span>AU<span class="br0">]</span>:.
 State or Province Name <span class="br0">(</span>full name<span class="br0">)</span> <span class="br0">[</span>Some-State<span class="br0">]</span>:.
 Locality Name <span class="br0">(</span>eg, city<span class="br0">)</span> <span class="br0">[</span><span class="br0">]</span>:.
 Organization Name <span class="br0">(</span>eg, company<span class="br0">)</span> <span class="br0">[</span>Internet Widgets Pty Ltd<span class="br0">]</span>:Mort Bay Consulting Pty. Ltd.
 Organizational Unit Name <span class="br0">(</span>eg, section<span class="br0">)</span> <span class="br0">[</span><span class="br0">]</span>:Jetty
 Common Name <span class="br0">(</span>eg, YOUR name<span class="br0">)</span> <span class="br0">[</span><span class="br0">]</span>:jetty.eclipse.org
 Email Address <span class="br0">[</span><span class="br0">]</span>:
 
 <span class="co0">#</span></pre>
                </div>
              </div>
              <p>
                You now have the minimal requirements to run an SSL connection and could proceed directly to
                <a href="Configure%20SSL.html#Loading_Keys_and_Certificates">Loading Keys and Certificates</a>
                to load these keys and certificates into a JSSE keystore. However the browser will not trust the certificate you have generated, and will prompt the user to this effect. While what you have at this point is often sufficient for testing, most public sites need to request a trusted certificate, as shown in the section,
                <a href="Configure%20SSL.html#Generating_a_CSR_from_OpenSSL">Generating a CSR from OpenSSL</a>
                to obtain a certificate.
              </p>
              <h3>
                <span class="mw-headline" id="Using_Keys_and_Certificates_from_Other_Sources">Using Keys and Certificates from Other Sources</span>
              </h3>
              <p>
                If you have keys and certificates from other sources, you can proceed directly to
                <a href="Configure%20SSL.html#Loading_Keys_and_Certificates">Loading Keys and Certificates</a>
                .
              </p>
              <h2>
                <span class="mw-headline" id="Requesting_a_Trusted_Certificate">Requesting a Trusted Certificate</span>
              </h2>
              <p>The keys and certificates generated with the JDK keytool and OpenSSL are sufficient to run an SSL connector. However the browser will not trust the certificate you have generated, and it will prompt the user to this effect.</p>
              <p>To obtain a certificate that most common browsers will trust, you need to request a well-known certificate authority (CA) to sign your key/certificate. Such trusted CAs include: AddTrust, Entrust, GeoTrust, RSA Data Security, Thawte, VISA, ValiCert, Verisign, and beTRUSTed, among others.</p>
              <p>Each CA has its own instructions (look for JSSE or OpenSSL sections), but all involve a step that generates a certificate signing request (CSR).</p>
              <h3>
                <span class="mw-headline" id="Generating_a_CSR_from_keytool">Generating a CSR from keytool</span>
              </h3>
              <p>
                The following command generates the file
                <tt>jetty.csr</tt>
                using keytool for a key/cert already in the keystore:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> keytool <span class="re5">-certreq</span> <span class="re5">-alias</span> jetty <span class="re5">-keystore</span> keystore <span class="re5">-file</span> jetty.csr</pre>
                </div>
              </div>
              <p>
                <br />
              </p>
              <h3>
                <span class="mw-headline" id="Generating_a_CSR_from_OpenSSL">Generating a CSR from OpenSSL</span>
              </h3>
              <p>
                The following command generates the file
                <tt>jetty.csr</tt>
                using OpenSSL for a key in the file
                <tt>jetty.key</tt>
                :
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> openssl req <span class="re5">-new</span> <span class="re5">-key</span> jetty.key <span class="re5">-out</span> jetty.csr</pre>
                </div>
              </div>
              <p>
                Notice that this command uses only the existing key from
                <tt>jetty.key</tt>
                file, and not a certificate in
                <tt>jetty.crt</tt>
                as generated with OpenSSL. You need to enter the details for the certificate again.
              </p>
              <h2>
                <span class="mw-headline" id="Loading_Keys_and_Certificates">Loading Keys and Certificates</span>
              </h2>
              <p>Once a CA has sent you a certificate, or if you generated your own certificate without keytool, you need to load it into a JSSE keystore.</p>
              <p>
                <br />
              </p>
              <h3>
                <span class="mw-headline" id="Loading_Certificates_with_keytool">Loading Certificates with keytool</span>
              </h3>
              <p>You can use keytool to load a certificate in PEM form directly into a keystore. The PEM format is a text encoding of certificates; it is produced by OpenSSL, and is returned by some CAs. An example PEM file is:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> jetty.crt
 <span class="re5">-----BEGIN</span> CERTIFICATE-----
 MIICSDCCAfKgAwIBAgIBADANBgkqhkiG9w0BAQQFADBUMSYwJAYDVQQKEx1Nb3J0
 IEJheSBDb25zdWx0aW5nIFB0eS4gTHRkLjEOMAwGA1UECxMFSmV0dHkxGjAYBgNV
 BAMTEWpldHR5Lm1vcnRiYXkub3JnMB4XDTAzMDQwNjEzMTk1MFoXDTAzMDUwNjEz
 MTk1MFowVDEmMCQGA1UEChMdTW9ydCBCYXkgQ29uc3VsdGluZyBQdHkuIEx0ZC4x
 DjAMBgNVBAsTBUpldHR5MRowGAYDVQQDExFqZXR0eS5tb3J0YmF5Lm9yZzBcMA0G
 CSqGSIb3DQEBAQUAA0sAMEgCQQC5V4oZeVdhdhHqa9L2
                    <span class="sy0">/</span>
                    ZnKySPWUqqy81riNfAJ
 7uALW0kEv
                    <span class="sy0">/</span>
                    LtlG34dOOcVVt
                    <span class="sy0">/</span>
                    PK8
                    <span class="sy0">/</span>
                    bU4dlolnJx1SpiMZbKsFAgMBAAGjga4wgasw
 HQYDVR0OBBYEFFV1gbB1XRvUx1UofmifQJS
                    <span class="sy0">/</span>
                    MCYwMHwGA1UdIwR1MHOAFFV1gbB1
 XRvUx1UofmifQJS
                    <span class="sy0">/</span>
                    MCYwoVikVjBUMSYwJAYDVQQKEx1Nb3J0IEJheSBDb25zdWx0
 aW5nIFB0eS4gTHRkLjEOMAwGA1UECxMFSmV0dHkxGjAYBgNVBAMTEWpldHR5Lm1v
 cnRiYXkub3JnggEAMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEEBQADQQA6NkaV
 OtXzP4ayzBcgK
                    <span class="sy0">/</span>
                    qSCmF44jdcARmrXhiXUcXzjxsLjSJeYPJojhUdC2LQKy+p4ki8
 Rcz6oCRvCGCe5kDB
 <span class="re5">-----END</span> CERTIFICATE-----</pre>
                </div>
              </div>
              <p>
                The following command loads a PEM encoded certificate in the
                <tt>jetty.crt</tt>
                file into a JSSE keystore:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> keytool <span class="re5">-keystore</span> keystore <span class="re5">-import</span> <span class="re5">-alias</span> jetty <span class="re5">-file</span> jetty.crt <span class="re5">-trustcacerts</span></pre>
                </div>
              </div>
              <p>
                Depending on the situation, you might not require the
                <tt>-trustcacerts</tt>
                option. Try the operation without it if you like. If the certificate you receive from the CA is not in a format that keytool understands, you can use the
                <tt>openssl</tt>
                command to convert formats:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> openssl x509 <span class="re5">-in</span> jetty.der <span class="re5">-inform</span> DER <span class="re5">-outform</span> PEM <span class="re5">-out</span> jetty.crt</pre>
                </div>
              </div>
              <h3>
                <span class="mw-headline" id="Loading_Keys_and_Certificates_via_PKCS12">Loading Keys and Certificates via PKCS12</span>
              </h3>
              <p>If you have a key and certificate in separate files, you need to combine them into a PKCS12 format file to load into a new keystore. The certificate can be one you generated yourself or one returned from a CA in response to your CSR.</p>
              <p>
                The following OpenSSL command combines the keys in
                <tt>jetty.key</tt>
                and the certificate in the
                <tt>jetty.crt</tt>
                file into the
                <tt>jetty.pkcs12</tt>
                file:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> openssl pkcs12 <span class="re5">-inkey</span> jetty.key <span class="re5">-in</span> jetty.crt <span class="re5">-export</span> <span class="re5">-out</span> jetty.pkcs12</pre>
                </div>
              </div>
              <p>If you have a chain of certificates, because your CA is an intermediary, build the PKCS12 file as follows:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> <span class="co0"># cat example.crt intermediate.crt [intermediate2.crt]... rootCA.crt &gt; cert-chain.txt</span>
 <span class="co0"># openssl pkcs12 -export -inkey example.key -in cert-chain.txt -out example.pkcs12</span></pre>
                </div>
              </div>
              <p>The order of certificates must be from server to rootCA, as per RFC2246 section 7.4.2.</p>
              <p>
                OpenSSL asks for an
                <i>export password</i>
                . A non-empty password seems to be required to make the next step work. Then load the resulting PKCS12 file into a JSSE keystore with the following jetty utility class:
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="java source-java">
                  <pre class="de1" xml:space="preserve"> java <span class="sy0">-</span>classpath $JETTY_HOME<span class="sy0">/</span>lib<span class="sy0">/</span>jetty<span class="sy0">-</span>util<span class="sy0">-</span><span class="nu0">6.1</span><span class="sy0">-</span>SNAPSHOT.<span class="me1">jar</span><span class="sy0">:</span>$JETTY_HOME<span class="sy0">/</span>lib<span class="sy0">/</span>jetty<span class="sy0">-</span><span class="nu0">6.1</span><span class="sy0">-</span>SNAPSHOT.<span class="me1">jar</span> org.<span class="me1">eclipse</span>.<span class="me1">jetty</span>.<span class="me1">security</span>.<span class="me1">PKCS12Import</span> <span class="co2">jetty.pkcs12</span> keystore</pre>
                </div>
              </div>
              <p>
                This asks for two passphrases. Give the password from the last step as the input passphrase and you are set. The "output passphrase" must appear in your
                <tt>jetty.xml</tt>
                config file as both the Password and KeyPassword of the SunJsseListener that uses the certificate.
              </p>
              <p>You can also use keytool (starting form jdk1.6) to import a PKCS12 file with the following command:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> keytool <span class="re5">-importkeystore</span> <span class="re5">-srckeystore</span> jetty.pkcs12 <span class="re5">-srcstoretype</span> PKCS12 <span class="re5">-destkeystore</span> keystore</pre>
                </div>
              </div>
              <h2>
                <span class="mw-headline" id="Configuring_Jetty">Configuring Jetty</span>
              </h2>
              <p>
                Beginning with Jetty 7.3.1, the preferred way to configure SSL parameters for the connector is by configuring the
                <a class="external text" href="https://archive.eclipse.org/jetty/7.6.16.v20140903/apidocs/org/eclipse/jetty/http/ssl/SslContextFactory.html" rel="nofollow">SslContextFactory</a>
                object and passing it to the connector's constructor.
              </p>
              <p>Jetty has two SSL connectors–the SslSocketConnector and the SslSelectChannelConnector. The SslSocketConnector is built on top of the Jetty SocketConnector which is Jetty's implementation of a blocking connector. It uses Java's SslSocket to add the security layer. The SslSelectChannelConnector is an extension of Jetty's SelectChannelConnector which uses non-blocking IO. For its security layer, it uses java nio SslEngine. You can configure these two connectors similarly; the difference is in the implementation.</p>
              <p>
                The following is an example of an SslSelectChannelConnector configuration. You can configure an SslSocketConnector the same way–just change the value of the class to
                <tt>org.eclipse.jetty.server.ssl.SslSocketConnector</tt>
                .
              </p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve">   <span class="sc3"><span class="re1">&lt;Call</span> <span class="re0">name</span>=<span class="st0">"addConnector"</span><span class="re2">&gt;</span></span>
     <span class="sc3"><span class="re1">&lt;Arg<span class="re2">&gt;</span></span></span>
       <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.server.ssl.SslSelectChannelConnector"</span><span class="re2">&gt;</span></span>
         <span class="sc3"><span class="re1">&lt;Arg<span class="re2">&gt;</span></span></span>
           <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.http.ssl.SslContextFactory"</span><span class="re2">&gt;</span></span>
             <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"keyStore"</span><span class="re2">&gt;</span><span class="re1">&lt;SystemProperty</span> <span class="re0">name</span>=<span class="st0">"jetty.home"</span> <span class="re0">default</span>=<span class="st0">"."</span> <span class="re2">/&gt;</span></span>/etc/keystore<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
             <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"keyStorePassword"</span><span class="re2">&gt;</span></span>OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
             <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"keyManagerPassword"</span><span class="re2">&gt;</span></span>OBF:1u2u1wml1z7s1z7a1wnl1u2g<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
             <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"trustStore"</span><span class="re2">&gt;</span><span class="re1">&lt;SystemProperty</span> <span class="re0">name</span>=<span class="st0">"jetty.home"</span> <span class="re0">default</span>=<span class="st0">"."</span> <span class="re2">/&gt;</span></span>/etc/keystore<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
             <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"trustStorePassword"</span><span class="re2">&gt;</span></span>OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
           <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
         <span class="sc3"><span class="re1">&lt;/Arg<span class="re2">&gt;</span></span></span>
         <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"port"</span><span class="re2">&gt;</span></span>8443<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
         <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"maxIdleTime"</span><span class="re2">&gt;</span></span>30000<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
       <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
     <span class="sc3"><span class="re1">&lt;/Arg<span class="re2">&gt;</span></span></span>
   <span class="sc3"><span class="re1">&lt;/Call<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <p>Other properties that you can set for the SslContextFactory include:</p>
              <ul>
                <li>certAlias–Alias of a certificate to use.</li>
                <li>keyStoreType–Default value: "JKS."</li>
                <li>keyStoreProvider–Default is the SunJSSE provider.</li>
                <li>trustStoreType–Default value: "JKS".</li>
                <li>trustStoreProvider–Default is the SunJSSE provider.</li>
                <li>sslKeyManagerFactoryAlgorithm–Set to the value of the "ssl.KeyManagerFactory.algorithm" system property. If there is no such property, the default is "SunX509."</li>
                <li>sslTrustManagerFactoryAlgorithm–set to the value of the "ssl.TrustManagerFactory.algorithm" system property. If there is no such property, the default is "SunX509."</li>
                <li>secureRandomAlgorithm–Default value is null.</li>
                <li>protocol–Default value is "TLS."</li>
                <li>provider–Default is the first provider that supports that protocol.</li>
                <li>
                  includeCipherSuites–See
                  <a href="CipherSuites.html" title="Jetty/Howto/CipherSuites">How to configure SSL Cipher Suites</a>
                  .
                </li>
                <li>
                  excludeCipherSuites–See
                  <a href="CipherSuites.html" title="Jetty/Howto/CipherSuites">How to configure SSL Cipher Suites</a>
                  .
                </li>
                <li>needClientAuth–Default is false</li>
                <li>wantClientAuth–Defaults is false.</li>
                <li>validateCerts–Default is false.</li>
                <li>allowRenegotiate–Default is false.</li>
                <li>crlPath–Path to certificate revocation list file for SSL certificate validation.</li>
                <li>maxCertPathLengh–Maximum allowed number of intermediate certificates, default is -1 (unlimited).</li>
              </ul>
              <p>
                If there is no value for the
                <i>truststore</i>
                , the system uses the
                <i>keystore</i>
                value. You can obfuscate passwords by using the Jetty
                <a href="Secure%20Passwords.html" title="Jetty/Howto/Secure Passwords">password utility</a>
                .
              </p>
              <h3>
                <span class="mw-headline" id="Choosing_a_Directory_for_the_keystore">Choosing a Directory for the keystore</span>
              </h3>
              <p>The keystore file in the example above is given relative to the jetty home directory. For production, choose a private directory with restricted access to keep your keystore in. Even though it has a password on it, the password may be configured into the runtime environment so is vulnerable to theft. You can now start Jetty the normal way (make sure that jcert.jar, jnet.jar and jsse.jar are on your classpath) and SSL can be used with a URL like:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="bash source-bash">
                  <pre class="de1" xml:space="preserve"> https:<span class="sy0">//</span>localhost:<span class="nu0">8443</span><span class="sy0">/</span></pre>
                </div>
              </div>
              <h3>
                <span class="mw-headline" id="Setting_the_Port_for_https">Setting the Port for https</span>
              </h3>
              <p>
                Remember that the default port for https is 443 not 80, so change 8443 to 443 if you want to be able to use URLs without explicit port numbers. For a production site it normally makes sense to have an HttpListener on port 80 and a SunJsseListener on port 443. Because these are privileged ports, you might want to use a redirection mechanism to map port 80 to, for example, 8080 and 443 to, for example, 8443. For details on this, see
                <a href="Port80.html" title="Jetty/Howto/Port80">Accessing Port 80 as a non-Root User</a>
                .
              </p>
              <h3>
                <span class="mw-headline" id="Redirecting_http_requests_to_https">Redirecting http requests to https</span>
              </h3>
              <p>To redirect http to https, the webapp should indicate it needs CONFIDENTIAL or INTEGRAL connections from users. This is
done in web.xml:</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve"><span class="sc3"><span class="re1">&lt;web-app<span class="re2">&gt;</span></span></span>
  ...
  <span class="sc3"><span class="re1">&lt;security-constraint<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;web-resource-collection<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;web-resource-name<span class="re2">&gt;</span></span></span>Everything in the webapp<span class="sc3"><span class="re1">&lt;/web-resource-name<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;url-pattern<span class="re2">&gt;</span></span></span>/*<span class="sc3"><span class="re1">&lt;/url-pattern<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/web-resource-collection<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;user-data-constraint<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;transport-guarantee<span class="re2">&gt;</span></span></span>CONFIDENTIAL<span class="sc3"><span class="re1">&lt;/transport-guarantee<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/user-data-constraint<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/security-constraint<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/web-app<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <p>Then you need to tell the plain http connector if the users try to access that webapp using plain http, they
should be redirected to the port of your ssl connector (the "confidential port"):</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve"><span class="sc3"><span class="re1">&lt;Call</span> <span class="re0">name</span>=<span class="st0">"addConnector"</span><span class="re2">&gt;</span></span>
   <span class="sc3"><span class="re1">&lt;Arg<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.nio.SelectChannelConnector"</span><span class="re2">&gt;</span></span>
         ...
         <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"confidentialPort"</span><span class="re2">&gt;</span></span>443<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
   <span class="sc3"><span class="re1">&lt;/Arg<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/Call<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <p>That's it. If the webapp doesn't indicate it needs CONFIDENTIAL or INTEGRAL connections (as it may be considered
a deployment issue), you can set this requirement in the context (so you must deploy the webapp as a WebAppContext
instead of just a war file):</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="xml source-xml">
                  <pre class="de1" xml:space="preserve">  <span class="sc3"><span class="re1">&lt;Configure</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.webapp.WebAppContext"</span><span class="re2">&gt;</span></span>
     <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"securityHandler"</span><span class="re2">&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.security.ConstraintSecurityHandler"</span><span class="re2">&gt;</span></span>
            <span class="sc3"><span class="re1">&lt;Call</span> <span class="re0">name</span>=<span class="st0">"addConstraintMapping"</span><span class="re2">&gt;</span></span>
                <span class="sc3"><span class="re1">&lt;Arg<span class="re2">&gt;</span></span></span>
                   <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.security.ConstraintMapping"</span><span class="re2">&gt;</span></span>
                       <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"pathSpec"</span><span class="re2">&gt;</span></span>/*<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
                       <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"constraint"</span><span class="re2">&gt;</span></span>
                          <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.util.security.Constraint"</span><span class="re2">&gt;</span></span>
                             <span class="sc-1">&lt;!-- 2 means CONFIDENTIAL. 1 means INTEGRITY --&gt;</span>
                             <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"dataConstraint"</span><span class="re2">&gt;</span></span>2<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
                          <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
                       <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
                   <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
                <span class="sc3"><span class="re1">&lt;/Arg<span class="re2">&gt;</span></span></span>
            <span class="sc3"><span class="re1">&lt;/Call<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
     <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/Configure<span class="re2">&gt;</span></span></span></pre>
                </div>
              </div>
              <h3>
                <span class="mw-headline" id="Configuring_SSL_for_Earlier_Versions_of_Jetty">Configuring SSL for Earlier Versions of Jetty</span>
              </h3>
              <p>
                For instructions on configuring SSL for versions earlier than Jetty 7.3.1, refer to
                <a href="../Reference/SSL%20Connectors.html#Using_Deprecated_Methods" title="Jetty/Reference/SSL Connectors">Using Deprecated Methods to Configure SSL for Jetty</a>
                .
              </p>
              <p>
                <br />
              </p>
              <h2>
                <span class="mw-headline" id="Password_Issues">Password Issues</span>
              </h2>
              <p>
                If the configuration does not include passwords, you can provide them as as java properties (
                <tt>jetty.ssl.password</tt>
                and
                <tt>jetty.ssl.keypassword</tt>
                ), else the system prompts for them. Remember that putting your password on the command line is a security risk. You can also set them as properties within the config file, but this risks accidental discovery by developers.
              </p>
              <p>
                If jetty is given a password that begins with "OBF:" it is treated as an obfuscated password. You can obfuscated passwords by running
                <a class="external text" href="https://archive.eclipse.org/jetty/8.1.16.v20140903/apidocs/index.html?org/eclipse/jetty/util/security/Password.html" rel="nofollow">org.eclipse.jetty.http.util.Password</a>
                as a main class. This can protect passwords from casual observation.
              </p>
              <p>
                See
                <a href="Secure%20Passwords.html" title="Jetty/Howto/Secure Passwords">Secure Passwords</a>
                for more details.
              </p>
              <h2>
                <span class="mw-headline" id="Renewing_Certificates">Renewing Certificates</span>
              </h2>
              <p>
                If you are updating your configuration to use a newer certificate, as when the old one is expiring, just load the newer certificate as described in the section,
                <a href="Configure%20SSL.html#Loading_Keys_and_Certificates">Loading Keys and Certificates</a>
                . If you imported the key and certificate originally using the PKCS12 method, use an alias of "1" rather than "jetty", because that is the alias the PKCS12 process enters into the keystore.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
