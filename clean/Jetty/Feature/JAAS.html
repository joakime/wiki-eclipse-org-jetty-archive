<html>
<head>
    <title>Jetty WTP Plugin</title>
    <link rel="stylesheet" media="screen, print" href="wiki-style.css"/>
</head>
<body>
<div id="mainContent" class="col-md-20">
                      <ul class="nav nav-tabs noprint hidden-print" role="tablist">
                       <li class="active" id="ca-nstab-main"><a href="JAAS.html" accesskey="c" title="View the content page [c]" tabindex="-1">Page</a></li>
                        <li id="ca-talk" class="new"><a accesskey="t" href="edit" tabindex="-1" title="Discussion about the content page [t]">Discussion</a></li>
                        <li id="ca-viewsource"><a href="edit" accesskey="e" tabindex="-1" title="This page is protected.&#10;You can view its source [e]">View source</a></li>
                        <li id="ca-history" class="collapsible"><a title="Past revisions of this page [h]" tabindex="-1" accesskey="h" href="edit">History</a></li>
                      </ul>            <div class="tab-content background-white">
              <div id="tab-pane-main-page-content" class="tab-pane active">

                
                <h1 id="firstHeading" class="firstHeading page-header">
                  <span dir="auto">Jetty/Feature/JAAS</span>
                </h1>
                <div id="main-page-content">

                  <div id="contentSub" class="alert alert-small alert-warning"><span class="subpages">&lt; <a href="../../Jetty.html" title="Jetty">Jetty</a>‎ | <a href="../Feature.html" title="Jetty/Feature">Feature</a></span></div>

                  
                  
                  <div dir="ltr" class="mw-content-ltr" lang="en" id="mw-content-text"><p><br/>
</p><p><br/>
</p>
<div class="toc" id="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="JAAS.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1"><a href="JAAS.html#Feature"><span class="tocnumber">2</span> <span class="toctext">Feature</span></a></li>
<li class="toclevel-1"><a href="JAAS.html#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-1"><a href="JAAS.html#A_Closer_Look_at_JAASLoginService"><span class="tocnumber">4</span> <span class="toctext">A Closer Look at JAASLoginService</span></a>
<ul>
<li class="toclevel-2"><a href="JAAS.html#RoleCheckPolicy"><span class="tocnumber">4.1</span> <span class="toctext">RoleCheckPolicy</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#CallbackHandler"><span class="tocnumber">4.2</span> <span class="toctext">CallbackHandler</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#Role_Principal_Implementation_Class"><span class="tocnumber">4.3</span> <span class="toctext">Role Principal Implementation Class</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#Sample_LoginModules"><span class="tocnumber">4.4</span> <span class="toctext">Sample LoginModules</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#Passwords.2FCredentials"><span class="tocnumber">4.5</span> <span class="toctext">Passwords/Credentials</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#JDBCLoginModule"><span class="tocnumber">4.6</span> <span class="toctext">JDBCLoginModule</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#DataSourceLoginModule"><span class="tocnumber">4.7</span> <span class="toctext">DataSourceLoginModule</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#PropertyFileLoginModule"><span class="tocnumber">4.8</span> <span class="toctext">PropertyFileLoginModule</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#LdapLoginModule"><span class="tocnumber">4.9</span> <span class="toctext">LdapLoginModule</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="JAAS.html#Writing_your_Own_LoginModule"><span class="tocnumber">5</span> <span class="toctext">Writing your Own LoginModule</span></a></li>
<li class="toclevel-1"><a href="JAAS.html#Other_Goodies"><span class="tocnumber">6</span> <span class="toctext">Other Goodies</span></a>
<ul>
<li class="toclevel-2"><a href="JAAS.html#RequestParameterCallback"><span class="tocnumber">6.1</span> <span class="toctext">RequestParameterCallback</span></a></li>
<li class="toclevel-2"><a href="JAAS.html#Example_JAAS_WebApp"><span class="tocnumber">6.2</span> <span class="toctext">Example JAAS WebApp</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="JAAS.html#Additional_Resources"><span class="tocnumber">7</span> <span class="toctext">Additional Resources</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<div class="messagebox" style="background-color: #f9f6b7; border: 1px solid #c4c295; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; font-size: 150%; color: white; background-color: #FF8888; padding: 50px">
<div style="float: left; margin-left: -40px;"><a href="https://wiki.eclipse.org/File:Warning2.png" class="image"><img alt="Warning2.png" src="../../images/3/37/Warning2.png" height="35" width="35"/></a></div>
<div>Jetty 7 and Jetty 8 are now EOL (End of Life)<br/>
<p><br/>
<br/>
<br/>
THIS IS NOT THE DOCUMENTATION YOU ARE LOOKING FOR!!!!!<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
All development and stable releases are being performed with Jetty 9 and Jetty 10.<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
This <b>wiki is now officially out of date</b> and all content has been moved to the <a href="http://www.eclipse.org/jetty/documentation" rel="nofollow" class="external text">Jetty Documentation Hub</a><br/> 
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</p>
Direct Link to updated documentation: <a href="http://www.eclipse.org/jetty/documentation/current/jaas-support.html" rel="nofollow" class="external free">http://www.eclipse.org/jetty/documentation/current/jaas-support.html</a></div>
</div>
<p><br/>
JAAS implements a Java version of the standard Pluggable Authentication Module (PAM) framework.
</p><p>JAAS can be used for two purposes:
</p>
<ul><li> for authentication of users, to reliably and securely determine who is currently executing Java code, regardless of whether the code is running as an application, an applet, a bean, or a servlet; and</li>
<li> for authorization of users to ensure they have the access control rights (permissions) required to do the actions performed.</li></ul>
<p>JAAS authentication is performed in a pluggable fashion. This permits applications to remain independent from underlying authentication technologies. New or updated authentication technologies can be plugged under an application without requiring modifications to the application itself. Applications enable the authentication process by instantiating a LoginContext object, which in turn references a Configuration to determine the authentication technology(ies), or LoginModule(s), to be used in performing the authentication. Typical LoginModules may prompt for and verify a username and password. Others may read and verify a voice or fingerprint sample.
</p>
<h2><span id="Feature" class="mw-headline">Feature</span></h2>
<p>Many application servers support JAAS as a means of bringing greater flexibility to the declarative security models of the J2EE( now known as the Java EE) <a rel="nofollow" class="external text" href="http://java.sun.com/javaee/index.jsp">specification</a>. Jetty support for JAAS provides greater alternatives for servlet security, and increases the portability of web applications.
</p><p>The JAAS support aims to dictate as little as possible whilst providing a sufficiently flexible infrastructure to allow users to drop in their own custom <a class="external text" rel="nofollow" href="http://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/JAASLMDevGuide.html">LoginModules</a>. 
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>Using JAAS with jetty is very simply a matter of declaring a org.eclipse.jetty.plus.jaas.JAASLoginService, creating a jaas login module configuration file and specifying it on the jetty run line. Let's look at an example.
</p><p><b>Step 1</b>
</p><p>Configure a jetty org.eclipse.jetty.plus.jaas.JAASLoginService to match the &lt;realm-name&gt; in your web.xml file. For example, if the web.xml contains a realm called "xyz" like so:
</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;login-config<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;auth-method<span class="re2">&gt;</span></span></span>FORM<span class="sc3"><span class="re1">&lt;/auth-method<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;realm-name<span class="re2">&gt;</span></span></span>xyz<span class="sc3"><span class="re1">&lt;/realm-name<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;form-login-config<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;form-login-page<span class="re2">&gt;</span></span></span>/login/login<span class="sc3"><span class="re1">&lt;/form-login-page<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;form-error-page<span class="re2">&gt;</span></span></span>/login/error<span class="sc3"><span class="re1">&lt;/form-error-page<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/form-login-config<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/login-config<span class="re2">&gt;</span></span></span></pre></div></div>
<p>Then the following JAASLoginService would be declared in a jetty configuration file:
</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="xml source-xml"><pre class="de1">    <span class="sc3"><span class="re1">&lt;Call</span> <span class="re0">name</span>=<span class="st0">"addBean"</span><span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;Arg<span class="re2">&gt;</span></span></span>
          <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.plus.jaas.JAASLoginService"</span><span class="re2">&gt;</span></span>
           <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"Name"</span><span class="re2">&gt;</span></span>Test JAAS Realm<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
           <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"LoginModuleName"</span><span class="re2">&gt;</span></span>xyz<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
          <span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span>
      <span class="sc3"><span class="re1">&lt;/Arg<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/Call<span class="re2">&gt;</span></span></span></pre></div></div>
<div class="messagebox" style="background-color: #f9f6b7; border: 1px solid #c4c295; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px;">
<div style="float: left; margin-left: -40px;"><a class="image" href="https://wiki.eclipse.org/File:Important.png"><img alt="Important.png" src="../../images/f/ff/Important.png" height="35" width="35"/></a></div>
<div><b>Important</b><br/>The name of the realm-name that you declare in web.xml must match exactly the Name element in your jetty config file.</div>
</div>
<p><br/>
For your convenience, the <a href="http://dist.codehaus.org/jetty" rel="nofollow" class="external text">Hightide</a> distribution of jetty contains an example configuration file in etc/jetty-jaas.xml.
</p><p><b>Step 2</b>
</p><p>Set up your LoginModule in a configuration file, following the <a rel="nofollow" class="external text" href="http://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/login/Configuration.html">syntax rules</a>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ini source-ini"><pre class="de1">xyz <span class="br0">{</span>
       com.acme.SomeLoginModule required debug<span class="sy0">=</span><span class="re2">true</span><span class="co0">;</span>
    <span class="br0">}</span><span class="co0">;</span></pre></div></div>
<div style="background-color: #f9f6b7; border: 1px solid #c4c295; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px;" class="messagebox">
<div style="float: left; margin-left: -40px;"><a href="https://wiki.eclipse.org/File:Important.png" class="image"><img width="35" height="35" alt="Important.png" src="../../images/f/ff/Important.png"/></a></div>
<div><b>Important</b><br/>It is imperative that the application name on the first line is exactly the same as the LoginModuleName from your jetty config file.</div>
</div>
<p><br/>
<b>Step 3</b>
</p><p>You now need to invoke jetty with support for jaas. This involves 3 elements:
</p>
<ul><li> adding extra jars to jetty's classpath</li>
<li> adding the jetty config file with the JAASLoginService declaration to the startup sequence</li>
<li> adding the jaas system property java.security.auth.login.config which specifies the location of your login module config file</li></ul>
<p>If you're running the <a href="http://dist.codehaus.org/jetty" class="external text" rel="nofollow">Hightide</a> distribution of jetty, the extra jars will already be on the classpath, so your run line becomes:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="bash source-bash"><pre class="de1">java -Djava.security.auth.login.config=mylogin.conf <span class="re5">-jar</span> start.jar <span class="br0">[</span>myjaas.xml<span class="br0">]</span></pre></div></div>
<p>Where myjaas.xml is the jetty config file containing the JAASLoginService declaration from step 1. If you modified the provided $JETTY_HOME/etc/jetty-jaas.xml file then this will already be part of the startup sequence, so there is no need to specify it on the run line. 
</p><p>If you're running the standard distribution of jetty, you will need to provide all 3 elements, so the run line becomes:
</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="bash source-bash"><pre class="de1">java -Djava.security.auth.login.config=mylogin.conf <span class="re5">-jar</span> start.jar <span class="re2">OPTIONS</span>=plus myjaas.xml</pre></div></div>
<p>Where myjaas.xml is the jetty config file you created in step 1. You might like to edit the start.ini file to add the extra OPTION and the myjaas.xml file to jetty's startup sequence to simplify the command line.
</p><p><br/>
</p>
<h2><span id="A_Closer_Look_at_JAASLoginService" class="mw-headline">A Closer Look at JAASLoginService</span></h2>
<p>To allow the greatest degree of flexibility in using JAAS with web applications, the JAASLoginService supports a couple of configuration options. Note that you don't ordinarily need to set these explicitly, as jetty has defaults which will work in 99% of cases. However, should you need to, you can configure:
</p>
<ul><li> a policy for role-based authorization (Default: org.eclipse.jetty.plus.jaas.StrictRoleCheckPolicy)</li>
<li> a CallbackHandler (Default: org.eclipse.jetty.plus.jaas.callback.DefaultCallbackHandler)</li>
<li> a list of classnames for the Principal implementation that equate to a user role (Default: org.eclipse.jetty.plus.jaas.JAASRole)</li></ul>
<p>Here's an example of setting each of these (to their default values):
</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="xml source-xml"><pre class="de1"><span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.plus.jaas.JAASLoginService"</span><span class="re2">&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"Name"</span><span class="re2">&gt;</span></span>Test JAAS Realm<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"LoginModuleName"</span><span class="re2">&gt;</span></span>xyz<span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"RoleCheckPolicy"</span><span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;New</span> <span class="re0">class</span>=<span class="st0">"org.eclipse.jetty.plus.jaas.StrictRoleCheckPolicy"</span><span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"CallbackHandlerClass"</span><span class="re2">&gt;</span></span>
       org.eclipse.jetty.plus.jaas.callback.DefaultCallbackHandler
  <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;Set</span> <span class="re0">name</span>=<span class="st0">"roleClassNames"</span><span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;Array</span> <span class="re0">type</span>=<span class="st0">"java.lang.String"</span><span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;Item<span class="re2">&gt;</span></span></span>org.eclipse.jetty.plus.jaas.JAASRole<span class="sc3"><span class="re1">&lt;/Item<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/Array<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/Set<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/New<span class="re2">&gt;</span></span></span></pre></div></div>
<h3><span id="RoleCheckPolicy" class="mw-headline">RoleCheckPolicy</span></h3>
<p>The RoleCheckPolicy must be an implementation of the org.eclipse.jetty.plus.jaas.RoleCheckPolicy interface and its purpose is to help answer the question "is User X in Role Y" for role-based authorization requests. The default implementation distributed with jetty is the org.eclipse.jetty.plus.jaas.StrictRoleCheckPolicy, which will assess a user as having a particular role iff that role is at the top of the stack of roles that have been temporarily pushed onto the user or if the user has no temporarily assigned roles, the role is amongst those configured for the user.
</p><p>Roles can be temporarily assigned to a user programmatically by using the pushRole(String rolename) method of the org.eclipse.jetty.plus.jaas.JAASUserPrincipal class.
</p><p>For the majority of webapps, the default StrictRoleCheckPolicy will be quite adequate, however you may provide your own implementation and set it on your JAASUserRealm instance.
</p>
<h3><span id="CallbackHandler" class="mw-headline">CallbackHandler</span></h3>
<p>A CallbackHandler is responsible for interfacing with the user to obtain usernames and credentials to be authenticated.
</p><p>Jetty ships with the org.eclipse.jetty.plus.jaas.DefaultCallbackHandler which interfaces the information contained in the request to the Callbacks that are requested by LoginModules. You can replace this default with your own implementation if you have specific requirements not covered by the default.
</p>
<h3><span class="mw-headline" id="Role_Principal_Implementation_Class">Role Principal Implementation Class</span></h3>
<p>When LoginModules authenticate a user, they usually also gather all of the roles that a user has and place them inside the JAAS Subject. As LoginModules are free to use their own implementation of the JAAS Principal to put into the Subject, jetty needs to know which Principals represent the user and which represent his/her roles when performing authorization checks on &lt;security-constraint&gt;s. The example LoginModules that ship with jetty all use the org.eclipse.jetty.plus.jaas.JAASRole class. However, if you have plugged in some other LoginModules, you must configure the classnames of their role Principal implementations.
</p>
<h3><span id="Sample_LoginModules" class="mw-headline">Sample LoginModules</span></h3>
<ul><li> <a href="http://download.eclipse.org/jetty/stable-7/xref/org/eclipse/jetty/plus/jaas/spi/JDBCLoginModule.html" rel="nofollow" class="external text">org.eclipse.jetty.plus.jaas.spi.JDBCLoginModule</a></li>
<li> <a href="http://download.eclipse.org/jetty/stable-7/xref/org/eclipse/jetty/plus/jaas/spi/PropertyFileLoginModule" class="external text" rel="nofollow">org.eclipse.jetty.plus.jaas.spi.PropertyFileLoginModule</a></li>
<li> <a href="http://download.eclipse.org/jetty/stable-7/xref/org/eclipse/jetty/plus/jaas/spi/DataSourceLoginModule" rel="nofollow" class="external text">org.eclipse.jetty.plus.jaas.spi.DataSourceLoginModule</a></li>
<li> <a class="external text" rel="nofollow" href="http://download.eclipse.org/jetty/stable-7/xref/org/eclipse/jetty/plus/jaas/spi/LdapLoginModule">org.eclipse.jetty.plus.jaas.ldap.LdapLoginModule</a></li></ul>
<p>More on these modules follows, but first, a word about securing passwords in jetty config files:
</p>
<h3><span id="Passwords.2FCredentials" class="mw-headline">Passwords/Credentials</span></h3>
<p>Passwords can be stored in clear text, obfuscated or checksummed. The class <a rel="nofollow" class="external text" href="http://download.eclipse.org/jetty/stable-7/xref/org/eclipse/jetty/http/security/Password">org.eclipse.jetty.http.security.Password</a> should be used to generate all varieties of passwords,the output from which can be cut and pasted into property files or entered into database tables.
</p><p>Read more on <a href="https://wiki.eclipse.org/Jetty/Tutorial/Passwords" title="Jetty/Tutorial/Passwords">Securing Passwords</a>.
</p><p><br/>
</p>
<h3><span class="mw-headline" id="JDBCLoginModule">JDBCLoginModule</span></h3>
<p>The JDBCLoginModule stores user passwords and roles in a database that are accessed via JDBC calls. You can configure the JDBC connection information, as well as the names of the table and columns storing the username and credential, and the name of the table and columns storing the roles.
</p><p>Here is an example login module configuration file entry for it using an HSQLDB driver:
</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="ini source-ini"><pre class="de1">jdbc <span class="br0">{</span>
      org.eclipse.jetty.plus.jaas.spi.JDBCLoginModule required
      <span class="re1">debug</span><span class="sy0">=</span><span class="st0">"true"</span>
      <span class="re1">dbUrl</span><span class="sy0">=</span><span class="st0">"jdbc:hsqldb:."</span>
      <span class="re1">dbUserName</span><span class="sy0">=</span><span class="st0">"sa"</span>
      <span class="re1">dbDriver</span><span class="sy0">=</span><span class="st0">"org.hsqldb.jdbcDriver"</span>
      <span class="re1">userTable</span><span class="sy0">=</span><span class="st0">"myusers"</span>
      <span class="re1">userField</span><span class="sy0">=</span><span class="st0">"myuser"</span>
      <span class="re1">credentialField</span><span class="sy0">=</span><span class="st0">"mypassword"</span>
      <span class="re1">userRoleTable</span><span class="sy0">=</span><span class="st0">"myuserroles"</span>
      <span class="re1">userRoleUserField</span><span class="sy0">=</span><span class="st0">"myuser"</span>
      <span class="re1">userRoleRoleField</span><span class="sy0">=</span><span class="st0">"myrole"</span><span class="co0">;</span>
      <span class="br0">}</span><span class="co0">;</span></pre></div></div>
<p><br/>
There is no particular schema required for the database tables storing the authentication and role information. The properties userTable, userField, credentialField, userRoleTable, userRoleUserField, userRoleRoleField configure the names of the tables and the columns within them that are used to format the following queries:
</p><p>select &lt;credentialField&gt; from &lt;userTable&gt; where &lt;userField&gt; =?
select &lt;userRoleRoleField&gt; from &lt;userRoleTable&gt; where &lt;userRoleUserField&gt; =?
</p><p>Credential and role information is lazily read from the database when a previously unauthenticated user requests authentication. Note that this information is only cached for the length of the authenticated session. When the user logs out or the session expires, the information is flushed from memory.
</p><p>Note that passwords can be stored in the database in plain text or encoded formats - see "Passwords/Credentials" above.
</p><p><br/>
</p>
<h3><span class="mw-headline" id="DataSourceLoginModule">DataSourceLoginModule</span></h3>
<p>Similar to the JDBCLoginModule, but this LoginModule uses a DataSource to connect to the database instead of a jdbc driver. The DataSource is obtained by doing a jndi lookup on java:comp/env/${dnJNDIName}
</p><p>Here is a sample login module configuration for it:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ini source-ini"><pre class="de1">ds <span class="br0">{</span>
     org.eclipse.jetty.plus.jaas.spi.DataSourceLoginModule required
     <span class="re1">debug</span><span class="sy0">=</span><span class="st0">"true"</span>
     <span class="re1">dbJNDIName</span><span class="sy0">=</span><span class="st0">"ds"</span>
     <span class="re1">userTable</span><span class="sy0">=</span><span class="st0">"myusers"</span>
     <span class="re1">userField</span><span class="sy0">=</span><span class="st0">"myuser"</span>
     <span class="re1">credentialField</span><span class="sy0">=</span><span class="st0">"mypassword"</span>
     <span class="re1">userRoleTable</span><span class="sy0">=</span><span class="st0">"myuserroles"</span>
     <span class="re1">userRoleUserField</span><span class="sy0">=</span><span class="st0">"myuser"</span>
     <span class="re1">userRoleRoleField</span><span class="sy0">=</span><span class="st0">"myrole"</span><span class="co0">;</span>
    <span class="br0">}</span><span class="co0">;</span></pre></div></div>
<p><br/>
</p>
<h3><span id="PropertyFileLoginModule" class="mw-headline">PropertyFileLoginModule</span></h3>
<p>With this login module implementation, the authentication and role information is read from a property file.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ini source-ini"><pre class="de1">props <span class="br0">{</span>
        org.eclipse.jetty.plus.jaas.spi.PropertyFileLoginModule required
        <span class="re1">debug</span><span class="sy0">=</span><span class="st0">"true"</span>
        <span class="re1">file</span><span class="sy0">=</span><span class="st0">"/somewhere/somefile.props"</span><span class="co0">;</span>
      <span class="br0">}</span><span class="co0">;</span></pre></div></div>
<p>The file parameter is the location of a properties file of the same format as the etc/realm.properties example file. The format is:
</p><p>&lt;username&gt;: &lt;password&gt;[,&lt;rolename&gt; ...]
</p><p>Here's an example:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="ini source-ini"><pre class="de1">fred: OBF:1xmk1w261u9r1w1c1xmq,user,admin
harry: changeme,user,developer
tom: MD5:164c88b302622e17050af52c89945d44,user
dick: CRYPT:adpexzg3FUZAk,admin</pre></div></div>
<p>The contents of the file are fully read in and cached in memory the first time a user requests authentication.
</p>
<h3><span class="mw-headline" id="LdapLoginModule">LdapLoginModule</span></h3>
<p>This requires JDK1.5 or above. Here's an example:
</p>
<div class="mw-geshi mw-code mw-content-ltr" dir="ltr"><div class="ini source-ini"><pre class="de1">ldaploginmodule <span class="br0">{</span>
   org.eclipse.jetty.plus.jaas.spi.LdapLoginModule required
   <span class="re1">debug</span><span class="sy0">=</span><span class="st0">"true"</span>
   <span class="re1">contextFactory</span><span class="sy0">=</span><span class="st0">"com.sun.jndi.ldap.LdapCtxFactory"</span>
   <span class="re1">hostname</span><span class="sy0">=</span><span class="st0">"ldap.example.com"</span>
   <span class="re1">port</span><span class="sy0">=</span><span class="st0">"389"</span>
   <span class="re1">bindDn</span><span class="sy0">=</span><span class="st0">"cn=Directory Manager"</span>
   <span class="re1">bindPassword</span><span class="sy0">=</span><span class="st0">"directory"</span>
   <span class="re1">authenticationMethod</span><span class="sy0">=</span><span class="st0">"simple"</span>
   <span class="re1">forceBindingLogin</span><span class="sy0">=</span><span class="st0">"false"</span>
   <span class="re1">userBaseDn</span><span class="sy0">=</span><span class="st0">"ou=people,dc=alcatel"</span>
   <span class="re1">userRdnAttribute</span><span class="sy0">=</span><span class="st0">"uid"</span>
   <span class="re1">userIdAttribute</span><span class="sy0">=</span><span class="st0">"uid"</span>
   <span class="re1">userPasswordAttribute</span><span class="sy0">=</span><span class="st0">"userPassword"</span>
   <span class="re1">userObjectClass</span><span class="sy0">=</span><span class="st0">"inetOrgPerson"</span>
   <span class="re1">roleBaseDn</span><span class="sy0">=</span><span class="st0">"ou=groups,dc=example,dc=com"</span>
   <span class="re1">roleNameAttribute</span><span class="sy0">=</span><span class="st0">"cn"</span>
   <span class="re1">roleMemberAttribute</span><span class="sy0">=</span><span class="st0">"uniqueMember"</span>
   <span class="re1">roleObjectClass</span><span class="sy0">=</span><span class="st0">"groupOfUniqueNames"</span><span class="co0">;</span>
   <span class="br0">}</span><span class="co0">;</span></pre></div></div>
<h2><span id="Writing_your_Own_LoginModule" class="mw-headline">Writing your Own LoginModule</span></h2>
<p>If you want to implement your own custom LoginModule, there are two classes to be familiar with org.eclipse.jetty.plus.jaas.spi.AbstractLoginModule and org.eclipse.jetty.plus.jaas.spi.UserInfo.
</p><p>The org.eclipse.jetty.plus.jaas.spi.AbstractLoginModule implements all of the javax.security.auth.spi.LoginModule methods. All you need to do is to implement the getUserInfo method to return a org.eclipse.jetty.plus.jaas.UserInfo instance which encapsulates the username, password and role names (note: as java.lang.Strings) for a user.
</p><p>The AbstractLoginModule does not support any caching, so if you want to cache UserInfo (eg as does the org.eclipse.jetty.plus.jaas.spi.PropertyFileLoginModule) then you must provide this yourself.
</p>
<h2><span id="Other_Goodies" class="mw-headline">Other Goodies</span></h2>
<h3><span class="mw-headline" id="RequestParameterCallback">RequestParameterCallback</span></h3>
<p>As all servlet containers intercept and process a form submission with action j_security_check, it is usually not possible to insert any extra input fields onto a login form with which to perform authentication: you may only pass j_username and j_password. For those rare occasions when this is not good enough, and you require more information from the user in order to authenticate them, you can use the JAAS callback handler org.eclipse.jetty.plus.jaas.callback.RequestParameterCallback. This callback handler gives you access to all parameters that were passed in the form submission. To use it, in the login() method of your custom login module, add the RequestParameterCallback to the list of callback handlers the login module uses, tell it which params you are interested in, and then get the value of the parameter back. Here's an example:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="kw1">public</span> <span class="kw1">class</span> FooLoginModule <span class="kw1">extends</span> AbstractLoginModule
<span class="br0">{</span>
        .
        .
        .
 
     <span class="kw1">public</span> <span class="kw4">boolean</span> login<span class="br0">(</span><span class="br0">)</span>
        <span class="kw1">throws</span> LoginException
     <span class="br0">{</span>
        .
        .
        .
        <span class="me1">Callback</span><span class="br0">[</span><span class="br0">]</span> callbacks <span class="sy0">=</span> <span class="kw1">new</span> Callback<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span><span class="sy0">;</span>
        callbacks<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw1">new</span> NameCallback<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        callbacks<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw1">new</span> ObjectCallback<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
        <span class="co1">//as an example, look for a param named "extrainfo" in the request</span>
        <span class="co1">//use one RequestParameterCallback() instance for each param you want to access</span>
        callbacks<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy0">=</span> <span class="kw1">new</span> RequestParameterCallback <span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">(</span><span class="br0">(</span>RequestParameterCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">setParameterName</span> <span class="br0">(</span><span class="st0">"extrainfo"</span><span class="br0">)</span><span class="sy0">;</span>
        .
        .
        .
        <span class="me1">callbackHandler</span>.<span class="me1">handle</span><span class="br0">(</span>callbacks<span class="br0">)</span><span class="sy0">;</span>
        <span class="kw3">String</span> userName <span class="sy0">=</span> <span class="br0">(</span><span class="br0">(</span>NameCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">getName</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="kw3">Object</span> pwd <span class="sy0">=</span> <span class="br0">(</span><span class="br0">(</span>ObjectCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">getObject</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="kw3">List</span> paramValues <span class="sy0">=</span> <span class="br0">(</span><span class="br0">(</span>RequestParameterCallback<span class="br0">)</span>callbacks<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="br0">)</span>.<span class="me1">getParameterValues</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
        <span class="co1">//use the userName, pwd and the value(s) of the parameter named "extrainfo" to</span>
        <span class="co1">//authenticate the user</span>
        .
        .
        .
     <span class="br0">}</span></pre></div></div>
<p><br/>
</p>
<h3><span id="Example_JAAS_WebApp" class="mw-headline">Example JAAS WebApp</span></h3>
<p>The <a href="http://dist.codehaus.org/jetty" rel="nofollow" class="external text">Hightide</a> distribution of jetty contains an example webapp that uses JAAS.
</p>
<h2><span class="mw-headline" id="Additional_Resources">Additional Resources</span></h2>
<p>See Java Authentication and Authorization Service (JAAS) <a href="http://java.sun.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html" class="external text" rel="nofollow">Reference Guide</a> for more information about JAAS.
</p>

</div>

                    <div id="catlinks" class="catlinks"><div class="mw-normal-catlinks" id="mw-normal-catlinks"><a href="https://wiki.eclipse.org/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a title="Category:Jetty" href="https://wiki.eclipse.org/Category:Jetty">Jetty</a></li><li><a href="https://wiki.eclipse.org/Category:Jetty_Feature" title="Category:Jetty Feature">Jetty Feature</a></li></ul></div></div>
                                  </div>
              </div>
            </div>
          </div>
</body>
</html>
